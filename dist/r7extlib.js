!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.R7=t():e.R7=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){if("object"===("undefined"==typeof e?"undefined":y(e))&&(e=Object.keys(e)[0]),!p[e])throw new Error("non available key");return e}function i(e){var t=e.match(/(\w+):(\w+)/);return{source:t[1],event:t[2]}}function a(e,t,n){"focus"===e||"blur"===e?g[e]=t.bind(n):(x("addStreamListener",i(e)),g["stream:"+e]=t.bind(n))}function u(e){"focus"===e||"blur"===e?delete g[e]:delete g["stream:"+e]}function s(e){var t=e.data;return t.id?E.rpc(t):t.key?E.key(t):E.stream(t)}function c(e,t,n,r){"function"==typeof t&&(r=n,n=t,t=null);var o=x(e,t);return w[o]=n.bind(r),o}function f(e,t,n){function r(){for(var e in b)releaseKey(e);for(var t in g)u(t)}function o(){r(),k.unload(),k=null;for(var e in s)grabKey(e,s[e]);for(var t in c)a(t,c[t])}function i(){o(),c.focus&&c.focus()}if(k)return void console.error("iframe: already loaded");var s=l({},b),c=l({},g);r(),k=new v["default"](e),k.use("exit",i),grabKey("Back",function(){return k.onKeyBack()?k.goBack():void i()}),("undefined"==typeof e.exit||null===e.exit||e.exit)&&grabKey("Exit",function(){return k.onKeyExit()?k.resume():void i()}),k.load(function(e){e&&o(),t.call(n,e),!e&&c.blur&&c.blur()})}function d(e,t,n,r){return c(e,t,n,r)}var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n(2);var h=n(3),v=r(h),m="0.2.4",p={Up:!0,Down:!0,Right:!0,Left:!0,Enter:!0,Mute:!0,Vdown:!0,Vup:!0,Zoom:!0,Back:!0,Exit:!0,Guide:!0,Menu:!0,Numeric:!0,Rewind:!0,Play:!0,Forward:!0,Stop:!0,Pause:!0,Rec:!0,TV:!0},w={},b={},g={},k=null,E={rpc:function(e){var t=e.id,n=w[t];n&&e.id&&(e.hasOwnProperty("error")||e.hasOwnProperty("result"))&&(delete w[t],e.error?n(new Error(e.error.message)):n(null,e.result))},key:function S(e){var S=e.key,t=S.match(/Numeric([0-9])/i);t&&(S="Numeric",e.number=+t[1]);var n=b[S];n&&n(e)},stream:function(e){for(var t in e)if(g[t]){var n=g[t];n(e[t])}}},x=function(){var e=1;return function(t,n){return window.parent.postMessage({jsonrpc:"2.0",id:e,method:t,params:n},"*"),e++}}();d.VERSION=m,d.ready=function(e,t){window.addEventListener("load",function(){c("ready",function(n,r){r&&window.history.init(r.clearHistory),e.call(t)})},!1)},d.grabKey=function(e,t,n){var r=o(e);"object"===("undefined"==typeof e?"undefined":y(e))?x("addKeys",e):x("addKeys",[r]),b[r]=t.bind(n)},d.releaseKey=function(e){e=o(e),delete b[e],x("removeKeys",[e])},d.navigate=function(e,t,n,r){return c("navigate",{control:e,context:t},n,r)},d.addStreamListener=a,d.removeStreamListener=u,d.loadIframe=f,d.exit=function(){return x("exit")},window.addEventListener("message",s,!1),e.exports=d},function(e,t){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r=window.sessionStorage,o=function(){if(!r)return!1;try{return r.setItem("test","1"),r.removeItem("test"),!0}catch(e){return!1}};if(o()){var i,a={stack:[window.location.href],state:0};try{i=JSON.parse(r.getItem("R7History"))}catch(u){}i=i||n({},a),i.clear=function(){i.save()},i.save=function(){return this.stack[this.state]!==window.location.href&&(this.stack.length=this.state+1,this.stack.push(window.location.href),this.state=this.stack.length-1),r.setItem("R7History",JSON.stringify(this))},i.go=function(e){e=e||0;var t=this.state+e;if(0===e||!i.stack[t])return!1;this.state=t,window.location.href=this.stack[t];var n;void 0!==window.CustomEvent?(n=new CustomEvent("popstate",{state:{url:this.stack[t]}}),window.dispatchEvent(n)):(n=document.createEvent("Event"),n.initEvent("popstate",!0,!0,{state:{url:this.stack[t]}}),window.dispatchEvent(n))},i.pushState=function(e,t,n){return n?(this.stack.push(n),this.state=this.stack.length-1,r.setItem("R7History",JSON.stringify(this))):void 0},i.replaceState=function(e,t,n){return n?(this.stack[this.state]=n,r.setItem("R7History",JSON.stringify(this))):void 0},window.history=function(){};var s=window.history instanceof Function;s&&(window.History=function(){},window.History.prototype={}),Object.defineProperties(window.History.prototype,{init:{value:function(e){e?i.clear():i.save()}},save:{value:function(){i.save()}},state:{get:function(){return i.state}},go:{value:function(e){i.go(e)}},back:{value:function(){i.go(-1)}},forward:{value:function(){i.go(1)}},length:{get:function(){return i.stack.length}},pushState:{value:function(e,t,n){i.pushState(e,t,n)}},replaceState:{value:function(e,t,n){i.replaceState(e,t,n)}}}),window.__history=i,s&&(window.history=new window.History),window.addEventListener("hashchange",function(){history.save()},!1),window.Backbone&&window.Backbone.history&&(window.Backbone.history.history=window.history)}else console.warn("History can not be rewritten: window.sessionStorage not available!")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),s=r(u),c="allow-scripts allow-same-origin allow-forms",f=45e3,d={display:"none",width:"1280px",height:"720px",border:"0"},l=function(e){var t=document.createElement("a");t.href=e;for(var n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=/(?:^|&)([^&=]*)=?([^&]*)/g,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],i={},a=o.length,u=n.exec(t.href);a--;)i[o[a]]=u[a]||"";return i.queryKey={},i.query.replace(r,function(e,t,n){t&&(i.queryKey[t]=n)}),i},y=function(){function e(t){o(this,e);var n=t.url;if(!this.iframe){this.iframe=document.createElement("iframe"),this.iframe.sandbox=c,this.iframe.src=n;var r=i({},d,t.style);for(var a in r)this.iframe.style[a]=r[a]}this.el=t.el||document.body;var u=l(n),f=u.protocol+"://"+u.authority;this.router=new s["default"](this.iframe,f)}return a(e,[{key:"load",value:function(e,t){var n=this;e=e.bind(t),this.iframe.dataset.loaded||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.onTimeoutExpired.bind(this,e),f),window.addEventListener("message",this.router,!1),this.iframe.addEventListener("load",function(){n.loaded(e)},!1),this.el.appendChild(this.iframe))}},{key:"loaded",value:function(e){var t=this;this.iframe.removeEventListener("load",this._loaded,!1),this.iframe.dataset.loaded="loaded",this.router.use("ready",function(){clearTimeout(t.timeout),t.router.unuse("ready"),t.iframe.style.display="block",e()})}},{key:"onTimeoutExpired",value:function(e){e(new Error("iframe: timeout expired"))}},{key:"unload",value:function(){this.timeout&&clearTimeout(this.timeout),this.el.removeChild(this.iframe),window.removeEventListener("message",this.router,!1),this.iframe.removeEventListener("load",this._loaded,!1),delete this.router,delete this._loaded}},{key:"use",value:function(e,t,n){this.router.use(e,t,n)}},{key:"onKeyBack",value:function(){return!!this.router.onKeyBack}},{key:"goBack",value:function(){return this.router.onKeyBack()}},{key:"onKeyExit",value:function(){return!!this.router.onKeyExit}},{key:"resume",value:function(){return this.router.resume()}}]),e}();t["default"]=y},function(e,t){"use strict";function n(e,t){function n(e){return e?"function"==typeof e.toJSON?e.toJSON():e:null}function a(e,t,n){try{m({id:e,result:t,response:t},n)}catch(r){s(e,o,r,n)}}function u(e){return e instanceof Error?e.message:e instanceof XMLHttpRequest?"Request error: "+[e.status,e.method,e.url].join(" "):"string"==typeof e?e:"unknown error"}function s(e,t,n,r){var o=u(n);return m({id:e,error:{code:t,message:o}},r),new Promise(function(e,t){t(new Error(o))})}function c(e,t){var r={},o=n(t);r[e]="undefined"==typeof o?!0:o,m(r,null)}function f(e){return{handler:function(t){return new Promise(function(n,r){R7(e,t,function(e,t){e&&r(e),n(t)})})}}}function d(e){var t=e.source+":"+e.event,n="stream:"+t;R7.addStreamListener(t,c.bind(null,n))}function l(e){var t=e.control,n=e.context;return new Promise(function(e,r){R7.navigate(t,n,function(t,n){t&&r(t),e(n)})})}function y(e){if(e){Array.isArray(e)&&(e=i(e,!1));for(var t in e){var n=c.bind(null,"key",t);"Back"===t||"Exit"===t?p["onKey"+t]=n:R7.grabKey(t,n)}}}function h(e){if(e){Array.isArray(e)||(e=Object.keys(e));for(var t=0;t<e.length;t++){var n=e[t];"Back"===n||"Exit"===n?p["onKey"+n]=null:R7.releaseKey(n)}}}var v=function(e){return e.source!==window&&e.origin===t?e:void 0},m=function(t){e.contentWindow.postMessage(t,"*")},p=function(e){if(e=v(e)){if(!w)return new Promise(function(e,t){t(new Error("router: not mounted"))});var t=e.data,i=e.source;if("number"!=typeof t.id)return s(-1,r,"invalid request",i);var u=t.method||t.action;if("string"!=typeof u)return s(t.id,r,"invalid request",i);var c=w[u];c||(c=f(u));var d,l=c.handler;try{d="function"==typeof l?l.call(c.context,t.params):l}catch(y){d=new Error(y)}return new Promise(function(e,t){d instanceof Error&&t(d),e(d)}).then(n).then(function(e){a(t.id,e,i)},function(e){s(t.id,o,e,i)})}},w={};return p.use=function(e,t,n){return w[e]={handler:t,context:n},p},p.unuse=function(e){return delete w[e],p},p.broadcast=c,p.mount=function(){w||(w={}),p.use("addStreamListener",d),p.use("navigate",l),p.use("addKeys",y),p.use("removeKeys",h),R7.addStreamListener("focus",c.bind(null,"focus")),R7.addStreamListener("blur",c.bind(null,"blur"))},p.unmount=function(){w&&(w=null)},p.onKeyBack=p.onKeyExit=null,p.mount(),p}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n;var r=-32600,o=-32603,i=function(e,t){return t="undefined"!=typeof t&&null!==t?t:!0,(e||[]).reduce(function(e,n){return e[n]=t,e},{})}}])});
!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):"object"==typeof exports?exports.Mickey=r():t.Mickey=r()}(this,function(){return function(t){function r(n){if(e[n])return e[n].exports;var i=e[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r,e){"use strict";function n(t){var r=function(r){var e=A[r.keyCode];"click"===e?t.click():e&&t.move(e)};return{bind:_.bind(document.addEventListener,document,"keydown",r),unbind:_.bind(document.removeEventListener,document,"keydown",r)}}function i(t,r,e){return function(n){return n.hasAttribute(e+t)?r:0}}function o(t,r){function e(t,r){if(t){var e=document.createEvent("MouseEvents"),n=G.pos.x,i=G.pos.y;e.initMouseEvent(r,!0,!0,window,0,n,i,n,i,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}function o(e){return!!e&&(e.hasAttribute(r.prefix+"area")||e===t)}function c(t){return!!t&&t.hasAttribute(r.prefix+"limit")}function A(t){return!!t&&t.hasAttribute(r.prefix+"track")}function E(t,e){if(!t||!t.hasAttribute(r.prefix+"circular"))return!1;var n=t.getAttribute(r.prefix+"circular");return""===n||M[e]===n}function $(t,e){return!!e&&c(t)&&t.getAttribute(r.prefix+"limit")===C[e]}function B(t){return!!t&&t.hasAttribute(r.prefix+"selected")}function S(t,r,e){return 0!==e.y?!(r.left>=t.left+t.width||r.left+r.width<=t.left):0!==e.x?!(r.top>=t.top+t.height||r.top+r.height<=t.top):!1}function L(t,e,n,i){var o=n?g[n]:x(),u=y(o),c=t._r;t instanceof a&&(t=t.bound(o));var f=function(r){return h(v(t,r),o)>=0},l=_.sortBy(_.map(_.filter(_.map(e,function(t){return s(t,r.overlap)}),function(t){return t&&f(i?t.bound(u):t.center())}),function(e){var n=e.bound(u),i={el:e.el,proj:k(t,e.bound(u),o),dist:b(t,n),priority:1/0};return c&&S(c,e._r,o)?(0!==o.y&&(_.contains(r.priority,"left")&&(i.priority=n.x),_.contains(r.priority,"right")&&(i.priority=-n.x)),0!==o.x&&(_.contains(r.priority,"top")&&(i.priority=n.y),_.contains(r.priority,"bottom")&&(i.priority=-n.y)),i):i}),["proj","priority","dist"]);return l.length>1&&_.find(l,function(t){return t.priority<1/0})&&(l=_.filter(l,function(t){return t.priority<1/0})),l[0]&&l[0].el}function O(t,e){var n=s(L(t,e),r.overlap);return n&&n.contains(t,g)?n.el:void 0}function j(){var e=l(t,r.$area);return e.length?e:[t]}function R(){var t=j();return _.some(t,B)&&(t=_.sortBy(t,F)),_.first(t)}function q(t,e){var n=l(t,t.getAttribute(r.prefix+"area")||r.$href),i=_.some(n,c);return i&&(n=_.sortBy(n,J)),i&&e?_.filter(n,function(t){return!c(t)||$(t,e)}):n}function z(t){return G.focus(G.closest()||R(),t,!0)}if(!t)throw new Error("mickey: should pass a parent DOM element");var D=!1,I=!1;r=_.defaults(r||{},{hoverClass:"hover",areaClass:"hover",trackClass:"tracked",overlap:0,position:null,priority:"left,top",listener:n,observer:u,prefix:"data-nav-",$area:"[data-nav-area]",$href:null});var N,J=i("limit",1,r.prefix),F=i("selected",-1,r.prefix),G={version:"1.0.6",pos:r.position||x(),el:null,ar:null},H=r.listener(G),K=_.once(function(){N=r.observer(t,Q),H.bind&&H.bind(t)}),P=_.once(function(){N&&N.disconnect(),H.unbind&&H.unbind()});G.focus=function(n,i,u){if(_.isString(n)&&(n=t.querySelector(n)),o(n))return G.focus(G.defaults(n));var a=s(n,r.overlap);if(!a)return!1;var f=n,l=G.area(f),h=G.el,v=G.ar,y=c(f),x=l!==v;return x&&(G.ar=l,p(v,r.areaClass),d(l,r.areaClass)),f===h||l===v&&y&&!u||(G.pos=a.center(),G.el=f,p(h,r.hoverClass),d(h,r.trackClass,x&&A(v)),e(h,"mouseout"),e(f,"mouseover")),p(f,r.trackClass),d(f,r.hoverClass,!y),y&&$(f,i)&&G.click(n),I||(I=!0),!0},G.position=function(){return{x:G.pos.x,y:G.pos.y}},G.move=function(t){if(D)throw new Error("mickey: locked");var e=G.el,n=s(e,r.overlap);if(n){var i=G.area(),o=_.without(q(i,t),e),u=L(n,o,t);if(u)return G.focus(u,t);var c=+i.getAttribute(r.prefix+"z-index");if(!(c>0)){if(E(i,t))return G.focus(G.circular(t));var a=s(i,r.overlap),l=_.without(j(),i),p=L(a,l,t,!0);if(!p)return $(G.el,t)?G.click():!1;var d=q(p);if(1===d.length&&$(d[0],t))return G.click(d[0]);if(A(i)&&i.setAttribute(r.prefix+"track-pos",JSON.stringify(G.pos)),A(p)){var h=p.getAttribute(r.prefix+"track-pos"),v=f(p,"."+r.trackClass);u=v||h&&L(JSON.parse(h),d)}return G.focus(u||d[0],t)}}else if(!z(t))throw new Error("mickey: cannot move")},G.click=function(r){if(D||!I)throw new Error("mickey: locked");if(r=r||G.el,!t.contains(r,g))throw new Error("mickey: cannot click on non visible element");if(!r&&!z())throw new Error("mickey: cannot click");return e(r,"click"),!0},G.area=function(r){for(r=r||G.el;r&&r!==t;)if(r=r.parentNode,o(r))return r;return t},G.closest=function(t){var r=_.flatten(_.map(t?[t]:j(),q));return L(G.pos,r)},G.closestInArea=function(){return G.closest(G.ar)},G.defaults=function(t){return q(t||R())[0]},G.defaultsInArea=function(){return G.defaults(G.ar)},G.hovered=function(){var t=_.flatten(_.map(j(),q));return O(G.pos,t)},G.circular=function(t){var e,n=s(G.ar,r.overlap).center();return e=t?m(s(G.el,r.overlap),t,n):w(G.pos,n),L(e,q(G.ar),t)},G.block=function(){D=!0,d(G.el,"blocked")},G.unblock=function(){D=!1,p(G.el,"blocked")},G.clear=_.once(function(){P(),G.pos=x(),G.el=null,G.ar=null,t=null,D=!1,H=null}),G.update=function(){G.focus(G.closest())},G.init=function(){if(I)throw new Error("mickey: already initialized");return K(),G.focus(r.position?G.hovered():G.defaults()),G};var Q=function(){if(!I)return G.init();if(t&&!t.contains(G.el,g)){var e,n=G.ar;switch(n.getAttribute(r.prefix+"policy")){default:case"closest":e=G.closestInArea();break;case"defaults":e=G.defaultsInArea();break;case"hovered":e=G.hovered();break;case"circular":e=G.circular()}G.focus(e,null,!0)}};return G}var u=e(3),c=e(2),a=c.Box,s=c.createBox,c=e(4),f=c.$first,l=c.$find,p=c.$rmvClass,d=c.$addClass,c=e(1),h=c.dot,v=c.vec,y=c.opp,x=c.nil,b=c.dist1,k=c.distp,m=c.axisReflect,w=c.pointReflect,g={left:{x:-1,y:0},up:{x:0,y:-1},right:{x:1,y:0},down:{x:0,y:1}},A={37:"left",38:"up",39:"right",40:"down",13:"click"},C={left:"left",up:"top",right:"right",down:"bottom"},M={left:"horizontal",right:"horizontal",up:"vertical",down:"vertical"};t.exports=o},function(t){"use strict";function r(){return{x:0,y:0}}function e(t,r){return{x:r.x-t.x,y:r.y-t.y}}function n(t,r){return u(e(t,r))}function i(t,r,n){return o(l(e(t,r),n))}function o(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function u(t){return Math.abs(t.x)+Math.abs(t.y)}function c(t){return{x:-t.x,y:-t.y}}function a(t,r){return t.x*r.x+t.y*r.y}function s(t,r){return{x:2*r.x-t.x,y:2*r.y-t.y}}function f(t,r,e){switch(r){case"up":t._r.top=t._r.top+2*e.y;break;case"down":t._r.top=t._r.top-2*e.y;break;case"left":t._r.left=t._r.left+2*e.x;break;case"right":t._r.left=t._r.left-2*e.x}return t}function l(t,r){var e=a(t,r);return{x:e*r.x,y:e*r.y}}t.exports={nil:r,vec:e,dist1:n,distp:i,norm1:o,opp:c,dot:a,pointReflect:s,axisReflect:f}},function(t,r,e){"use strict";function n(t,r){if(t){var e=_.extend({},t.getBoundingClientRect());return e.height>0||e.width>0?(r&&(e.height=e.height-2*r,e.width=e.width-2*r,e.top=e.top+r,e.left=e.left+r,e.right=e.right-r,e.bottom=e.bottom-r),new i(t,e)):void 0}}function i(t,r){this.el=t,this._r=r}var o=e(1),u=o.vec,c=o.dot;i.prototype.contains=function(t,r){var e=this.center(),n=u(e,this.bound(r.down)),i=u(e,this.bound(r.right)),o=u(e,t);return 2*Math.abs(c(n,o))<=this._r.height&&2*Math.abs(c(i,o))<=this._r.width},i.prototype.center=function(){return{x:this._r.left+this._r.width/2,y:this._r.top+this._r.height/2}},i.prototype.bound=function(t){return{x:this._r.left+this._r.width*(1+t.x)/2,y:this._r.top+this._r.height*(1+t.y)/2}},t.exports={Box:i,createBox:n}},function(t){"use strict";t.exports=function(t,r){var e;return null!=window.MutationObserver?(e=new MutationObserver(r),e.observe(t,{attributes:!1,childList:!0,characterData:!0,subtree:!0})):(r=_.debounce(r,0),t.addEventListener("DOMSubtreeModified",r),e={disconnect:function(){t.removeEventListener("DOMSubtreeModified",r)}}),e}},function(t){"use strict";function r(t,r){return t.querySelector(r)}function e(t,r){return _.toArray(t.querySelectorAll(r))}function n(t,r,e){t&&e!==!1&&t.classList.add(r)}function i(t,r,e){t&&e!==!1&&t.classList.remove(r)}t.exports={$first:r,$find:e,$addClass:n,$rmvClass:i}}])});